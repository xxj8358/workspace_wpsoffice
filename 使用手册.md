# 序时账处理工具使用手册

## 工具概述

本工具用于处理序时账数据，生成格式化的Excel报表，包含合并单元格、设置边框、替换文本、按科目名称排序等功能。此外，工具还提供了数据验证、余额表检查和年份范围测试等辅助功能，确保数据处理的准确性和可靠性。

## 核心文件说明

1. **test_copy_table.py** - 主处理脚本，负责复制表格、合并单元格、设置格式、按科目名称排序等核心功能
2. **run_test_copy_table.bat** - 快速运行主脚本的批处理文件
3. **install_dependencies.bat** - 自动安装所需依赖库的批处理文件
4. **check_balance_sheet.py** - 余额表检查工具，用于验证余额表数据的准确性
5. **check_journal_data.py** - 序时账数据检查工具，用于验证输入数据的完整性
6. **verify_name_sorting.py** - 科目名称排序验证工具，确保工作表按科目名称正确排序
7. **final_verification.py** - 最终验证工具，综合检查处理结果的准确性
8. **test_year_limits.py** - 年份范围测试工具，测试不同年份数据的处理情况
9. **使用手册.md** - 详细的使用说明文档
10. **安装指南.md** - Python环境和依赖库安装指南
11. **年份范围测试结果.xlsx** - 年份范围测试的结果文件

## 如何解决 "ModuleNotFoundError: No module named 'pandas'" 错误

**重要提示**：您遇到的这个错误是因为Python环境中缺少必要的依赖库。请严格按照以下步骤操作：

1. **自动安装**：双击运行**install_dependencies.bat**文件，系统会自动安装所有必要的依赖库
2. **手动安装**：如果自动安装失败，可以使用管理员权限打开命令提示符，运行 `python -m pip install pandas openpyxl xlrd` 命令来安装
3. **验证安装**：安装完成后，可以运行测试脚本来确认所有库已正确安装

## 使用方法

### 数据准备

1. 准备您的序时账数据，确保数据包含以下必要字段：日期、凭证编号、科目编码、科目名称、借贷方向、金额等
2. 确保数据格式统一，特别是日期和金额格式

### 处理数据

1. 确认环境：确保所有依赖库已正确安装（可通过运行install_dependencies.bat自动安装）
2. 将您的序时账数据文件放置在程序同一目录下
3. 双击运行**run_test_copy_table.bat**文件启动处理程序
4. 等待处理完成，程序会自动生成格式化的Excel报表

### 批量处理多家数据

当您需要处理多家公司或多个项目的数据时，只需按照以下方式操作：

1. 在序时账数据中，按照现有格式添加所有需要处理的数据行
2. 确保每行数据都包含正确的字段信息
3. 对于不同的公司或项目，可以通过科目编码或其他标识进行区分
4. 程序会自动根据科目名称生成对应的工作表，并按余额表中的科目名称顺序进行排序
5. 运行处理工具后，所有数据将被正确分类、格式化并排序

## 注意事项

1. **数据格式一致性**
   - 新增数据必须与现有数据保持相同的格式
   - 确保日期、金额、科目编码等字段格式正确
   - 科目名称应与余额表中的名称保持一致，以确保正确排序
   
2. **文件路径**
   - 不要随意更改文件的相对位置
   - 如果需要移动文件，请确保所有相关文件一起移动
   - 确保您在正确的文件路径下运行程序，所有文件应在同一目录中
   - 不要在多个不同路径下同时保留程序副本，这可能导致混淆
   
3. **运行环境**
   - 确保已安装Python 3.x
   - 必要的依赖库：pandas, openpyxl, xlrd
   - 推荐使用install_dependencies.bat自动安装所有依赖
   - 具体安装说明请参考**安装指南.md**
   
4. **错误处理**
   - 如果程序运行出错，请检查数据格式是否正确
   - 查看命令行输出的错误信息以获取更多详情
   - 可以使用check_journal_data.py验证输入数据的完整性

## 输出文件

处理完成后，结果将保存在当前目录下的处理结果文件中。文件名会根据输入文件自动生成。

您可以打开此文件查看生成的报表，其中包含按科目名称排序的多个工作表。

## 验证工具的使用

为确保数据处理的准确性，本工具提供了多个验证脚本：

1. **verify_name_sorting.py** - 验证生成的工作表是否按科目名称正确排序
   - 使用方法：双击运行，程序会自动检查最新的处理结果

2. **check_balance_sheet.py** - 检查余额表数据的准确性
   - 使用方法：双击运行，程序会分析余额表数据并生成检查报告

3. **final_verification.py** - 综合验证工具，检查所有处理结果
   - 使用方法：双击运行，程序会执行全面的验证检查

## 常见问题

**Q: 程序无法运行，显示 "ModuleNotFoundError: No module named 'pandas'"**
A: 这是最常见的问题，请双击运行install_dependencies.bat自动安装所有依赖库。如果自动安装失败，请使用管理员权限打开命令提示符，尝试使用国内镜像源进行安装。

**Q: 添加新数据后，程序没有处理怎么办？**
A: 请检查数据格式是否与现有数据一致，特别是科目编码、日期格式等关键字段。您可以使用check_journal_data.py来验证数据的完整性。

**Q: 如何确认工作表是否按科目名称正确排序？**
A: 可以运行verify_name_sorting.py工具，它会自动检查工作表的排序是否符合余额表中的科目名称顺序。

**Q: 如何调整生成报表的格式？**
A: 如果需要调整报表格式，请修改test_copy_table.py文件中的相关代码，如合并单元格、设置边框等部分。

**Q: 程序运行很慢怎么办？**
A: 处理大量数据时可能会较慢，请耐心等待。如果数据量非常大，可以考虑分批处理。

**Q: 找不到Python或pip命令怎么办？**
A: 确认已正确安装Python，并已将Python添加到系统环境变量中。重新安装Python时，请务必勾选"Add Python to PATH"选项。