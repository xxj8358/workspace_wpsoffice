# 序时账处理工具 - 安装指南

本指南将帮助您正确安装和配置序时账处理工具所需的Python环境和依赖库，确保程序能够正常运行。工具用于处理序时账数据，生成格式化的Excel报表，并支持按科目名称排序等功能。

## 步骤一：确认Python已安装

系统中已经安装了Python 3.13.7版本，这满足程序的运行要求。如果您的系统中未安装Python，请从[Python官网](https://www.python.org/downloads/)下载并安装最新版本，安装时务必勾选"Add Python to PATH"选项。

## 步骤二：安装必要的Python库

本工具需要安装以下Python库才能正常运行：pandas、openpyxl、xlrd。我们提供了两种安装方式，推荐使用自动安装方式。

### 方式一：自动安装（推荐）

1. 在程序所在目录找到`install_dependencies.bat`文件
2. 右键点击该文件，选择"以管理员身份运行"
3. 等待安装完成，命令窗口会自动关闭

### 方式二：手动安装

如果自动安装失败，可以按照以下步骤手动安装：

1. 在Windows搜索栏中输入"cmd"
2. 右键点击"命令提示符"，选择"以管理员身份运行"
3. 在命令提示符中运行以下命令：

```
python -m pip install pandas openpyxl xlrd
```

### 备选安装方法

如果上述命令失败，可以尝试以下替代方法：

1. **使用国内镜像源加快安装速度**
   ```
python -m pip install pandas openpyxl xlrd -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

2. **不使用管理员权限安装**
   ```
python -m pip install pandas openpyxl xlrd --user
   ```

3. **更新pip后再安装**
   ```
python -m pip install --upgrade pip
python -m pip install pandas openpyxl xlrd
   ```

## 验证安装

安装完成后，可以在命令提示符中运行以下命令来验证各库是否安装成功：

```
python -c "import pandas; print('pandas安装成功')"
python -c "import openpyxl; print('openpyxl安装成功')"
python -c "import xlrd; print('xlrd安装成功')"
```

如果所有命令都显示"安装成功"，则表示依赖库已正确安装。

## 步骤三：运行程序

安装完成后，您可以通过以下方法之一运行主处理程序：

### 方法一：直接运行批处理文件（推荐）

1. 在文件资源管理器中找到 `run_test_copy_table.bat` 文件
2. 双击该文件运行主处理程序

### 方法二：通过命令行运行

1. 打开命令提示符
2. 使用 `cd` 命令导航到程序所在文件夹：
   ```
   cd d:\xxj\java\workspace_office
   ```
3. 输入以下命令运行主处理程序：
   ```
   python test_copy_table.py
   ```

### 运行验证工具

除了主处理程序外，本工具还提供了多个验证脚本，您可以根据需要运行：

1. **verify_name_sorting.py** - 验证生成的工作表是否按科目名称正确排序
   - 运行方式：双击该文件或在命令行中运行 `python verify_name_sorting.py`

2. **check_balance_sheet.py** - 检查余额表数据的准确性
   - 运行方式：双击该文件或在命令行中运行 `python check_balance_sheet.py`

3. **final_verification.py** - 综合验证工具，检查所有处理结果
   - 运行方式：双击该文件或在命令行中运行 `python final_verification.py`

## 常见问题及解决方案

### 1. 找不到Python或pip命令
- 确认已正确安装Python，并已将Python添加到系统环境变量中
- 重新安装Python时，请务必勾选"Add Python to PATH"选项
- 可以在命令提示符中运行`python --version`和`pip --version`来验证是否安装成功

### 2. 安装过程中出现权限错误
- 确保以管理员身份运行命令提示符或批处理文件
- 或使用`--user`参数进行用户级安装
- 检查您的用户账户是否有足够的权限安装软件

### 3. 安装速度慢或连接超时
- 使用国内镜像源（如清华镜像源）可以显著提高安装速度
- 检查网络连接是否稳定
- 暂时关闭防火墙或安全软件，它们可能会阻止pip连接到Python包服务器

### 4. 程序运行后出现"ModuleNotFoundError"错误
- 确认所有必要的依赖库已正确安装
- 可以使用验证安装部分的命令检查各库是否安装成功
- 尝试使用管理员权限重新运行程序

### 5. 程序运行过程中出现Excel相关错误
- 请确保您的电脑上安装了WPS Office或Microsoft Office
- 检查输入文件格式是否正确，确保包含必要的数据字段
- 关闭所有Excel文件后再运行程序

### 6. 生成的报表中工作表排序不正确
- 确保您的科目名称与余额表中的名称保持一致
- 可以运行verify_name_sorting.py工具来检查工作表排序是否正确

## 输入输出说明

### 输入文件
- 程序支持处理包含序时账数据的Excel文件
- 数据应包含以下必要字段：日期、凭证编号、科目编码、科目名称、借贷方向、金额等
- 确保数据格式统一，特别是日期和金额格式

### 输出文件
- 处理完成后，结果将保存在当前目录下的处理结果文件中
- 文件名会根据输入文件自动生成，通常格式为"原文件名_处理结果.xlsx"
- 输出文件包含按科目名称排序的多个工作表

## 进一步帮助

如果您在使用过程中遇到任何问题，请参考以下资源：
- 详细的使用说明请查阅`使用手册.md`
- 可以通过运行验证工具来检查数据处理结果的准确性
- 对于技术问题，可以联系开发人员获取支持

祝您使用愉快！